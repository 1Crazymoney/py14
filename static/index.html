<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>py14 - Python to C++14 Transpiler</title>
    <link href="//cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css" rel="stylesheet" type="text/css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.7.0/codemirror.css" rel="stylesheet">
    <style>
    body {
      font-size: 1.6em;
    }
    .CodeMirror {
      font-size: 1.7rem;
    }
    </style>
  </head>
  <body>
  <div class="container">
    <div class="row">
      <h1>
        <span>Python to C++14 Transpiler</span>
        <iframe src="https://ghbtns.com/github-btn.html?user=lukasmartinelli&repo=py14&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
      </h1>
      <p>
        This is a little experiment that shows how far you can go with
        the C++ 14 <code>auto</code>  return type and templates.
        C++14 has such <a href="http://en.cppreference.com/w/cpp/language/template_argument_deduction">powerful type deduction</a> that it is possible to
        transpile Python into C++ without worrying about the missing type
        annotations in python.
      </p>
    </div>
    <form>
      <div class="row">
        <div class="three columns">
          <label for="choose-code-example">Choose example</label>
          <select class="u-full-width" id="choose-code-example">
            <option value="map">Map function</option>
            <option value="factorial">Factorial</option>
            <option value="pdf">Probability density function (PDF)</option>
            <option value="fibonacci">Fibonacci number</option>
            <option value="bubble_sort">Bubble sort</option>
          </select>
          <div id="code-examples" style="display: none;">
            <code id="map">
def map(values, fun):
    results = []
    for v in values:
        results.append(fun(v))
    return results
            </code>
            <code id="factorial">
def factorial(num):
    if num <= 1:
        return num
    return factorial(num-1) * num
            </code>
            <code id="pdf">
def pdf(x, mean, std_dev):
    term1 = 1.0 / ((2 * math.pi) ** 0.5)
    term2 = (math.e ** (-1.0 * (x-mean) ** 2.0 / 2.0 * (std_dev ** 2.0)))
    return term1 * term2
            </code>
            <code id="fibonacci">
def fib(n):
    if n == 1:
        return 1
    elif n == 0:
        return 0
    else:
        return fib(n-1) + fib(n-2)
            </code>
            <code id="bubble_sort">
def sort(seq):
    L = len(seq)
    for _ in range(L):
        for n in range(1, L):
            if seq[n] < seq[n - 1]:
                seq[n - 1], seq[n] = seq[n], seq[n - 1]
    return seq
            </code>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="six columns">
          <label for="exampleMessage">Python Code</label>
          <textarea id="python-code" class="u-full-width"></textarea>
          <button id="transpile" class="button-primary" type="button">Transpile</button>
        </div>
        <div class="six columns">
          <label for="exampleMessage">C++14 Code</label>
          <textarea id="cpp-code" class="u-full-width">
          </textarea>
        </div>
      </div>
    </form>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.7.0/codemirror.js" type="text/javascript"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.7.0/mode/python/python.js" type="text/javascript"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.7.0/mode/clike/clike.js" type="text/javascript"></script>
  <script>
$(function() {
  var pythonEditor = CodeMirror.fromTextArea(document.getElementById('python-code'), {
    mode: 'python'
  });
  var cppEditor = CodeMirror.fromTextArea(document.getElementById('cpp-code'), {
    mode: 'text/x-c++src',
    readOnly: true
  });

  $('#choose-code-example').change(function() {
    var exampleCodeId = $(this).val();
    var exampleCode = $(document.getElementById(exampleCodeId)).text();
    pythonEditor.getDoc().setValue(exampleCode);
    cppEditor.getDoc().setValue("");
  });
  $('#choose-code-example').change();

  $('#transpile').click(function() {
    var src = pythonEditor.getDoc().getValue();
    $.ajax({
      type: 'POST',
      url: '/transpile',
      data: src,
      contentType: 'text/plain'
    }).done(function(data) {
      cppEditor.getDoc().setValue(data);
    });
  });
});
  </script>
  </body>
</html>

